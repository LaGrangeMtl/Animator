{"version":3,"file":"animator.umd.js","sources":["../src/utils/guid.js","../src/Constants.js","../src/utils/screen.js","../src/functions/parseVal.js","../src/functions/parseRelativeVal.js","../src/functions/getContextScrollTop.js","../src/functions/valueOrDefault.js","../src/functions/precision.js","../src/functions/transform2d.js","../src/utils/constrain.js","../src/utils/Easings.js","../src/utils/map.js","../src/functions/constrainValues.js","../src/functions/transformValues.js","../src/utils/CssMatrix.js","../src/functions/getInitialMatrix.js","../src/index.js","../src/functions/parseWhen.js","../src/functions/matrix.js","../src/functions/calculate2dTransforms.js"],"sourcesContent":["//@ts-check\n\nexport function guid() {\n\treturn Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);\n}\n\n/**\n * @param {HTMLElement} element\n * @returns {string}\n */\nexport function elemGuid(element) {\n\tlet id = element.getAttribute('data-guid');\n\tif (!id) {\n\t\tid = guid();\n\t\telement.setAttribute('data-guid', id);\n\t}\n\treturn id;\n}\n","export const ELEM_BOTTOM = 'eb';\nexport const ELEM_TOP = 'et';\nexport const ELEM_CENTER = 'ec';\n\nexport const SCREEN_BOTTOM = 'sb';\nexport const SCREEN_TOP = 'st';\nexport const SCREEN_CENTER = 'sc';\n","import { SCREEN_TOP, SCREEN_CENTER, SCREEN_BOTTOM } from '../Constants';\n\nexport const screen = {};\n\nexport function updateScreen() {\n\tscreen[SCREEN_TOP] = 0;\n\tscreen[SCREEN_CENTER] = (window.innerHeight / 2);\n\tscreen[SCREEN_BOTTOM] = window.innerHeight;\n}\n\nupdateScreen();\n","import parseRelativeVal from './parseRelativeVal';\n\n/**\n * @param {string} prop \n * @param {string} value \n * @param {HTMLElement} elem \n */\nexport default function parseVal(prop, value, elem) {\n\tif (typeof value === 'number') return value;\n\n\tconst matches = value.match(/([-0-9.]+)(.+)/);\n\tconst val = parseFloat(matches[1]);\n\tconst unit = matches[2];\n\n\tswitch (unit) {\n\t\tcase 'vh': return (val / 100) * window.innerHeight;\n\t\tcase 'vw': return (val / 100) * window.innerWidth;\n\t\tcase 'px': return val;\n\t\tcase '%':\n\t\tdefault: return parseRelativeVal(prop, val, elem);\n\t}\n}\n","/**\n * @param {string} prop \n * @param {number} value \n * @param {HTMLElement} elem \n */\nexport default function parseRelativeVal(prop, value, elem) {\n\tconst rect = elem.getBoundingClientRect();\n\n\tswitch (prop) {\n\t\tcase 'y': return (value / 100) * rect.height;\n\t\tcase 'x':\n\t\tdefault: return (value / 100) * rect.width;\n\t}\n}\n","/**\n * @param {Element} context \n * @param {Scrollbar} scrollbar \n */\nexport default function getContextScrollTop(context) {\n\tlet ctx = context;\n\tif (context.tagName === 'HTML') ctx = document.scrollingElement || context;\n\treturn ctx.scrollTop;\n}\n","import precision from './precision';\n\nexport default function valueOrDefault(value, defaultValue = 0) {\n\treturn value !== undefined ? precision(value) : defaultValue;\n}\n","export default function precision(value, smallest = 0.00001) {\n\tif (!value || (value < smallest && value > -smallest)) return 0;\n\treturn value;\n}\n","import valueOrDefault from './valueOrDefault';\n\n/**\n * @param {object} values\n */\nexport default function transform2d(values) {\n\tif (\n\t\tvalues.rotation !== undefined\n\t\t|| values.scaleX !== undefined\n\t\t|| values.scaleY !== undefined\n\t\t|| values.x !== undefined\n\t\t|| values.y !== undefined\n\t\t|| values.z !== undefined\n\t) {\n\t\tconst t = `translate(${valueOrDefault(values.x, 0)}px, ${valueOrDefault(values.y, 0)}px)`;\n\t\tconst r = `rotate(${valueOrDefault(values.rotation, 0)}deg)`;\n\t\tconst s = `scale(${valueOrDefault(values.scaleX, 1)}, ${valueOrDefault(values.scaleY, 1)})`;\n\n\t\tvalues.transform = `${t} ${r} ${s}`;\n\t}\n\t\n\tdelete values.rotation;\n\tdelete values.scaleX;\n\tdelete values.scaleY;\n\tdelete values.x;\n\tdelete values.y;\n\tdelete values.z;\n\treturn values;\n}\n","/**\n * Limits a number between a range of 2 numbers\n * @param {(string|number)} num \n * @param {number} min \n * @param {number} max \n */\nexport const constrain = (num, min, max) => {\n\tconst n = typeof num === 'string' ? parseInt(num, 10) : num;\n\treturn Math.min(Math.max(n, min), max);\n};\n","/* eslint-disable */\n\nexport default {\n\teaseInQuad(t, b, c, d) {\n\t\treturn c * (t /= d) * t + b;\n\t},\n\teaseOutQuad(t, b, c, d) {\n\t\treturn -c * (t /= d) * (t - 2) + b;\n\t},\n\teaseInOutQuad(t, b, c, d) {\n\t\tif ((t /= d / 2) < 1) return c / 2 * t * t + b;\n\t\treturn -c / 2 * ((--t) * (t - 2) - 1) + b;\n\t},\n\teaseInCubic(t, b, c, d) {\n\t\treturn c * (t /= d) * t * t + b;\n\t},\n\teaseOutCubic(t, b, c, d) {\n\t\treturn c * ((t = t / d - 1) * t * t + 1) + b;\n\t},\n\teaseInOutCubic(t, b, c, d) {\n\t\tif ((t /= d / 2) < 1) return c / 2 * t * t * t + b;\n\t\treturn c / 2 * ((t -= 2) * t * t + 2) + b;\n\t},\n\teaseInQuart(t, b, c, d) {\n\t\treturn c * (t /= d) * t * t * t + b;\n\t},\n\teaseOutQuart(t, b, c, d) {\n\t\treturn -c * ((t = t / d - 1) * t * t * t - 1) + b;\n\t},\n\teaseInOutQuart(t, b, c, d) {\n\t\tif ((t /= d / 2) < 1) return c / 2 * t * t * t * t + b;\n\t\treturn -c / 2 * ((t -= 2) * t * t * t - 2) + b;\n\t},\n\teaseInQuint(t, b, c, d) {\n\t\treturn c * (t /= d) * t * t * t * t + b;\n\t},\n\teaseOutQuint(t, b, c, d) {\n\t\treturn c * ((t = t / d - 1) * t * t * t * t + 1) + b;\n\t},\n\teaseInOutQuint(t, b, c, d) {\n\t\tif ((t /= d / 2) < 1) return c / 2 * t * t * t * t * t + b;\n\t\treturn c / 2 * ((t -= 2) * t * t * t * t + 2) + b;\n\t},\n\teaseInSine(t, b, c, d) {\n\t\treturn -c * Math.cos(t / d * (Math.PI / 2)) + c + b;\n\t},\n\teaseOutSine(t, b, c, d) {\n\t\treturn c * Math.sin(t / d * (Math.PI / 2)) + b;\n\t},\n\teaseInOutSine(t, b, c, d) {\n\t\treturn -c / 2 * (Math.cos(Math.PI * t / d) - 1) + b;\n\t},\n\teaseInExpo(t, b, c, d) {\n\t\treturn (t == 0) ? b : c * Math.pow(2, 10 * (t / d - 1)) + b;\n\t},\n\teaseOutExpo(t, b, c, d) {\n\t\treturn (t == d) ? b + c : c * (-Math.pow(2, -10 * t / d) + 1) + b;\n\t},\n\teaseInOutExpo(t, b, c, d) {\n\t\tif (t == 0) return b;\n\t\tif (t == d) return b + c;\n\t\tif ((t /= d / 2) < 1) return c / 2 * Math.pow(2, 10 * (t - 1)) + b;\n\t\treturn c / 2 * (-Math.pow(2, -10 * --t) + 2) + b;\n\t},\n\teaseInCirc(t, b, c, d) {\n\t\treturn -c * (Math.sqrt(1 - (t /= d) * t) - 1) + b;\n\t},\n\teaseOutCirc(t, b, c, d) {\n\t\treturn c * Math.sqrt(1 - (t = t / d - 1) * t) + b;\n\t},\n\teaseInOutCirc(t, b, c, d) {\n\t\tif ((t /= d / 2) < 1) return -c / 2 * (Math.sqrt(1 - t * t) - 1) + b;\n\t\treturn c / 2 * (Math.sqrt(1 - (t -= 2) * t) + 1) + b;\n\t},\n\teaseInElastic(t, b, c, d) {\n\t\tvar s = 1.70158; let p = 0; let a = c;\n\t\tif (t == 0) return b; if ((t /= d) == 1) return b + c; if (!p) p = d * 0.3;\n\t\tif (a < Math.abs(c)) { a = c; var s = p / 4; }\t\telse var s = p / (2 * Math.PI) * Math.asin(c / a);\n\t\treturn -(a * Math.pow(2, 10 * (t -= 1)) * Math.sin((t * d - s) * (2 * Math.PI) / p)) + b;\n\t},\n\teaseOutElastic(t, b, c, d) {\n\t\tvar s = 1.70158; let p = 0; let a = c;\n\t\tif (t == 0) return b; if ((t /= d) == 1) return b + c; if (!p) p = d * 0.3;\n\t\tif (a < Math.abs(c)) { a = c; var s = p / 4; }\t\telse var s = p / (2 * Math.PI) * Math.asin(c / a);\n\t\treturn a * Math.pow(2, -10 * t) * Math.sin((t * d - s) * (2 * Math.PI) / p) + c + b;\n\t},\n\teaseInOutElastic(t, b, c, d) {\n\t\tvar s = 1.70158; let p = 0; let a = c;\n\t\tif (t == 0) return b; if ((t /= d / 2) == 2) return b + c; if (!p) p = d * (0.3 * 1.5);\n\t\tif (a < Math.abs(c)) { a = c; var s = p / 4; }\t\telse var s = p / (2 * Math.PI) * Math.asin(c / a);\n\t\tif (t < 1) return -0.5 * (a * Math.pow(2, 10 * (t -= 1)) * Math.sin((t * d - s) * (2 * Math.PI) / p)) + b;\n\t\treturn a * Math.pow(2, -10 * (t -= 1)) * Math.sin((t * d - s) * (2 * Math.PI) / p) * 0.5 + c + b;\n\t},\n\teaseInBack(t, b, c, d, s) {\n\t\tif (s == undefined) s = 1.70158;\n\t\treturn c * (t /= d) * t * ((s + 1) * t - s) + b;\n\t},\n\teaseOutBack(t, b, c, d, s) {\n\t\tif (s == undefined) s = 1.70158;\n\t\treturn c * ((t = t / d - 1) * t * ((s + 1) * t + s) + 1) + b;\n\t},\n\teaseInOutBack(t, b, c, d, s) {\n\t\tif (s == undefined) s = 1.70158; \n\t\tif ((t /= d / 2) < 1) return c / 2 * (t * t * (((s *= (1.525)) + 1) * t - s)) + b;\n\t\treturn c / 2 * ((t -= 2) * t * (((s *= (1.525)) + 1) * t + s) + 2) + b;\n\t},\n\teaseInBounce(t, b, c, d) {\n\t\treturn c - jQuery.easing.easeOutBounce(d - t, 0, c, d) + b;\n\t},\n\teaseOutBounce(t, b, c, d) {\n\t\tif ((t /= d) < (1 / 2.75)) {\n\t\t\treturn c * (7.5625 * t * t) + b;\n\t\t} else if (t < (2 / 2.75)) {\n\t\t\treturn c * (7.5625 * (t -= (1.5 / 2.75)) * t + 0.75) + b;\n\t\t} else if (t < (2.5 / 2.75)) {\n\t\t\treturn c * (7.5625 * (t -= (2.25 / 2.75)) * t + 0.9375) + b;\n\t\t} \n\t\treturn c * (7.5625 * (t -= (2.625 / 2.75)) * t + 0.984375) + b;\n\t\t\n\t},\n\teaseInOutBounce(t, b, c, d) {\n\t\tif (t < d / 2) return jQuery.easing.easeInBounce(t * 2, 0, c, d) * 0.5 + b;\n\t\treturn jQuery.easing.easeOutBounce(t * 2 - d, 0, c, d) * 0.5 + c * 0.5 + b;\n\t},\n};","/**\n * Map a number between two ranges\n * \n * @param {number} num \n * @param {number} in_min \n * @param {number} in_max \n * @param {number} out_min \n * @param {number} out_max \n */\nexport const map = (num, in_min, in_max, out_min, out_max) => {\n\tif (in_max === in_min) return out_max;\n\treturn (((num - in_min) * (out_max - out_min)) / (in_max - in_min)) + out_min;\n};\n","import { constrain } from '../utils/constrain';\nimport Easings from '../utils/Easings';\nimport { map } from '../utils/map';\n\n/**\n * @param {object} c \n * @param {AnimatorProp} prop \n */\nexport default function constrainValues(c, prop) {\n\tconst constrained = constrain(prop.st, prop.startOffset, prop.endOffset);\n\tconst prc = map(constrained, prop.startOffset, prop.endOffset, 0, 1);\n\tif (prop.ease) {\n\t\tc[prop.key] = Easings[prop.ease](prc, prop.startValue, prop.endValue - prop.startValue, 1);\n\t} else {\n\t\tc[prop.key] = map(constrained, prop.startOffset, prop.endOffset, prop.startValue, prop.endValue);\n\t}\n\treturn c;\n}\n","import constrainValues from './constrainValues';\nimport precision from './precision';\n/**\n\n * @param {AnimatorElement} el\n * @param {number} st\n */\nexport default function transformValues(el, st) {\n\treturn el.keys.map((propKey) => {\n\t\treturn {\n\t\t\tst,\n\t\t\tease: el.ease,\n\t\t\tkey: propKey,\n\t\t\t...el.keyframes[propKey]\n\t\t\t\t.reduce((propCarry, propVal, i) => {\n\t\t\t\t\tconst [offset, value] = propVal;\n\n\t\t\t\t\tswitch (i) {\n\t\t\t\t\t\tcase 0: \n\t\t\t\t\t\t\tpropCarry.startOffset = offset;\n\t\t\t\t\t\t\tpropCarry.startValue = value;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 1:\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tpropCarry.endOffset = offset;\n\t\t\t\t\t\t\tpropCarry.endValue = value;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\treturn propCarry;\n\t\t\t\t}, {}),\n\t\t};\n\t}).reduce(constrainValues, {});\n}\n","export const i2d = [\n\t1, 0, 0, 1, 0, 0,\n];\n\nexport const i3d = [\n\t1, 0, 0, 0,\n\t0, 1, 0, 0,\n\t0, 0, 1, 0,\n\t0, 0, 0, 1,\n];\n\nexport function identity() {\n\treturn [...i3d];\n}\n\nexport function identity2d() {\n\treturn [...i2d];\n}\n\nexport function translate(x, y, z) {\n\treturn [\n\t\t1, 0, 0, 0,\n\t\t0, 1, 0, 0,\n\t\t0, 0, 1, 0,\n\t\tx, y, z, 1,\n\t];\n}\n\nexport function scale(w, h, d) {\n\treturn [\n\t\tw, 0, 0, 0,\n\t\t0, h, 0, 0,\n\t\t0, 0, d, 0,\n\t\t0, 0, 0, 1,\n\t];\n}\n\nexport function rotate(a) {\n\n\treturn [\n\t\tMath.cos(a), -Math.sin(a), 0, 0,\n\t\tMath.sin(a), Math.cos(a), 0, 0,\n\t\t0, 0, 1, 0,\n\t\t0, 0, 0, 1,\n\t];\n}\n\nexport function toCSS(array) {\n\treturn 'matrix3d(' + array.join(',') + ')';\n}\n\nexport function fromString(string) {\n\treturn string.replace(/matrix(?:3d)?\\(/i, '').replace(')', '').split(',').map(x => parseFloat(x.trim()));\n}\n\nexport function isIdentity2d(matrix) {\n\treturn matrix.every((x, i) => x === i2d[i]);\n}\n\n// export function fromString(string) {\n// \tconst parsed = string.match(matrixRegex);\n// \tif (parsed === null || parsed.length < 7) throw new Error(`'${string}' is not a matrix`);\n// \treturn {\n// \t\ta: parseFloat(parsed[1]),\n// \t\tb: parseFloat(parsed[2]),\n// \t\tc: parseFloat(parsed[3]),\n// \t\td: parseFloat(parsed[4]),\n// \t\te: parseFloat(parsed[5]),\n// \t\tf: parseFloat(parsed[6]),\n// \t};\n// }\n\nexport function matrix2dto3d(m) {\n\tif (m.length === 16) return m;\n\tconst n = composeMultiple([\n\t\tidentity(),\n\t\ttranslate(m[4], m[5], 0),\n\t\trotate(0),\n\t\tscale(m[0], m[3], 1),\n\t]);\n\treturn n;\n}\n\nexport function compose(a, b) {\n\tconst result = [];\n\n\tconst a00 = a[0];\n\tconst a01 = a[1];\n\tconst a02 = a[2];\n\tconst a03 = a[3];\n\tconst a10 = a[4];\n\tconst a11 = a[5];\n\tconst a12 = a[6];\n\tconst a13 = a[7];\n\tconst a20 = a[8];\n\tconst a21 = a[9];\n\tconst a22 = a[10];\n\tconst a23 = a[11];\n\tconst a30 = a[12];\n\tconst a31 = a[13];\n\tconst a32 = a[14];\n\tconst a33 = a[15];\n\n\t// Cache only the current line of the second matrix\n\tlet b0 = b[0];\n\tlet b1 = b[1];\n\tlet b2 = b[2];\n\tlet b3 = b[3];\n\tresult[0] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n\tresult[1] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n\tresult[2] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n\tresult[3] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n\n\tb0 = b[4]; b1 = b[5]; b2 = b[6]; b3 = b[7]; //eslint-disable-line\n\tresult[4] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n\tresult[5] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n\tresult[6] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n\tresult[7] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n\n\tb0 = b[8]; b1 = b[9]; b2 = b[10]; b3 = b[11]; //eslint-disable-line\n\tresult[8] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n\tresult[9] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n\tresult[10] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n\tresult[11] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n\n\tb0 = b[12]; b1 = b[13]; b2 = b[14]; b3 = b[15]; //eslint-disable-line\n\tresult[12] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n\tresult[13] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n\tresult[14] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n\tresult[15] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n\n\treturn result;\n}\n\nexport function composeMultiple(matrices) {\n\tlet inputMatrix = matrices[0];\n\n\tfor (let i = 1; i < matrices.length; i += 1) {\n\t\tinputMatrix = compose(inputMatrix, matrices[i]);\n\t}\n\n\treturn inputMatrix;\n}\n","import { fromString, matrix2dto3d } from '../utils/CssMatrix';\n\n/**\n * @param {HTMLElement} elem \n */\nexport function getInitialMatrix(elem, is3D = false) {\n\tconst prev = elem.style.transform;\n\telem.style.transform = '';\n\tconst transform = window.getComputedStyle(elem).getPropertyValue('transform');\n\telem.style.transform = prev;\n\t\n\tif (transform === 'none') return null;\n\n\tlet m = fromString(transform);\n\tm = (m.length < 16 && is3D) ? matrix2dto3d(m) : m;\n\t\n\treturn m;\n}\n","//@ts-check\n\n// import 'core-js/fn/array/find';\n\nimport { elemGuid } from './utils/guid';\nimport * as Constants from './Constants';\nimport { updateScreen } from './utils/screen';\nimport parseWhen from './functions/parseWhen';\nimport parseVal from './functions/parseVal';\nimport getContextScrollTop from './functions/getContextScrollTop';\nimport transform2d from './functions/transform2d';\nimport transformValues from './functions/transformValues';\nimport matrix from './functions/matrix';\nimport { i3d } from './utils/CssMatrix';\nimport { getInitialMatrix } from './functions/getInitialMatrix';\nimport calculate2dTransforms from './functions/calculate2dTransforms';\n\nconst ATTR_NAME = 'data-animator-id';\n\n/**\n * @typedef {object} AnimatorElement\n * @property {HTMLElement} context\n * @property {string} ease\n * @property {array} initialMatrix\n * @property {object} keyframes\n * @property {array} keys\n * @property {HTMLElement} node\n */\n\n/**\n * @typedef {object} AnimatorProp\n * @property {string} ease\n * @property {number} endOffset\n * @property {number} endValue\n * @property {string} key\n * @property {number} st\n * @property {number} startOffset\n * @property {number} startValue\n */\n\n/**\n * @typedef {object} AnimatorRect\n * @property {number} top\n * @property {number} height\n */\n\nexport default class Animator {\n\tstatic instances = [];\n\n\tstatic updateAll() {\n\t\tAnimator.instances.forEach((instance) => {\n\t\t\tinstance.updateElements();\n\t\t});\n\t}\n\n\tanimations = [];\n\n\telements = [];\n\n\tcontexts = [];\n\n\thandlerDictionnary = {};\n\n\tloopDictionnary = {};\n\n\tlastValuesDictionnary = {};\n\t\n\tanimatorTopDictionnary = {};\n\n\tconstructor() {\n\t\tAnimator.instances.push(this);\n\t}\n\n\tstatic getConstants() {\n\t\treturn {\n\t\t\t...Constants,\n\t\t};\n\t}\n\n\t/**\n\t * @param {HTMLElement} elem \n\t * @param {AnimatorRect} rect \n\t * @param {string} animationId \n\t * @param {object} props \n\t * @param {HTMLElement} child\n\t */\n\tgetKeyframes = (elem, rect, animationId, props = null, child = null) => {\n\t\tlet animation = this.animations[animationId];\n\n\t\tif (props) {\n\t\t\tanimation = props;\n\t\t} else if (animation && !Array.isArray(animation)) {\n\t\t\tanimation = animation.props;\n\t\t}\n\n\t\tif (!animation) return {};\n\t\treturn animation.reduce((c, anim) => {\n\t\t\tlet values = { ...anim };\n\t\t\tdelete values.when;\n\t\t\tvalues = Object.keys(values).map(key => [key, anim[key]]);\n\t\t\tconst from = parseWhen(rect, anim.when);\n\n\t\t\treturn values.reduce((c2, value) => {\n\t\t\t\tconst [key, val] = value;\n\t\t\t\tc2[key] = c[key] || [];\n\t\t\t\tc2[key].push([from, parseVal(key, val, child || elem)]);\n\t\t\t\treturn c2;\n\t\t\t}, c);\n\t\t}, {});\n\t}\n\n\t/**\n\t * @param {HTMLElement} context \n\t * @param {HTMLElement} elem \n\t * @returns {AnimatorRect}\n\t */\n\tgetRect = (context, elem) => {\n\t\tconst style = elem.getAttribute('style');\n\t\telem.setAttribute('style', '');\n\t\tconst { top, height } = elem.getBoundingClientRect();\n\t\tconst st = getContextScrollTop(context);\n\t\tconst id = elemGuid(context);\n\t\telem.setAttribute('style', style);\n\n\t\treturn {\n\t\t\ttop: (top - this.animatorTopDictionnary[id]) + st,\n\t\t\theight,\n\t\t};\n\t}\n\n\t/**\n\t * @param {HTMLElement} elem \n\t */\n\tgetContext = (elem) => {\n\t\tlet context = null;\n\t\tlet el = elem;\n\n\t\twhile (el.parentElement && !context) {\n\t\t\tel = el.parentElement;\n\t\t\tif (el.getAttribute('data-scrollbar') || el.getAttribute('data-scrollbar') === '') {\n\t\t\t\tcontext = el;\n\t\t\t}\n\t\t}\n\t\tif (!this.contexts.find(ctx => context === ctx)) {\n\t\t\tconst id = elemGuid(context);\n\t\t\tthis.animatorTopDictionnary[id] = el.getBoundingClientRect().top + el.scrollTop;\n\t\t\tthis.contexts.push(context);\n\t\t}\n\t\treturn context;\n\t}\n\n\n\t/**\n\t * @param {string} id\n\t * @param {object} values \n\t */\n\thasChanged = (id, values) => {\n\t\tif (!this.lastValuesDictionnary[id]) return true;\n\t\treturn this.lastValuesDictionnary[id] !== JSON.stringify(values);\n\t};\n\n\t/**\n\t * @param {HTMLElement} ctx \n\t */\n\tscroll = (ctx) => {\n\t\tconst id = elemGuid(ctx);\n\t\tconst st = getContextScrollTop(ctx);\n\t\tif (this.loopDictionnary[id]) {\n\t\t\tcancelAnimationFrame(this.loopDictionnary[id]);\n\t\t}\n\t\t\n\t\tthis.loopDictionnary[id] = requestAnimationFrame(() => {\n\t\t\tthis.update(ctx, st);\n\t\t});\n\t};\n\n\t/**\n\t * @param {Number} st \n\t */\n\tvirtualScroll = (ctx, st) => {\n\t\tthis.update(ctx, st);\n\t};\n\n\t/**\n\t * @param {HTMLElement} ctx \n\t * @param {number} st \n\t */\n\tupdate = (ctx, st) => {\n\t\tthis.elements.forEach((el) => {\n\t\t\tif (el.context !== ctx || Object.keys(el.keyframes).length === 0) return;\n\n\t\t\tconst isSVG = ~el.node.namespaceURI.indexOf('svg');\n\t\t\tlet values = null;\n\t\t\tif (isSVG && el.node.tagName !== 'SVG') {\n\t\t\t\tvalues = transform2d(transformValues(el, st));\n\t\t\t} else if (el.is3DMatrix || (el.initialMatrix && el.initialMatrix.length === 16)) {\n\t\t\t\tif (!el.initialMatrix) el.initialMatrix = [...i3d];\n\t\t\t\tvalues = matrix(el.initialMatrix, transformValues(el, st));\n\t\t\t} else {\n\t\t\t\tvalues = calculate2dTransforms(el, st);\n\t\t\t}\n\n\t\t\tconst id = elemGuid(el.node);\n\t\t\tif (this.hasChanged(id, values)) {\n\t\t\t\tif (values) {\n\t\t\t\t\tObject.assign(el.node.style, values);\n\t\t\t\t}\n\t\t\t\tthis.lastValuesDictionnary[id] = JSON.stringify(values);\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * @param {string} animationId \n\t */\n\tgetEase = (animationId) => {\n\t\treturn (this.animations[animationId] && this.animations[animationId].ease) || null;\n\t}\n\n\t/**\n\t * @param {string} animationId \n\t */\n\tis3DMatrix = (animationId) => {\n\t\treturn (this.animations[animationId] && this.animations[animationId].force3d) || false;\n\t}\n\n\t/**\n\t * @param {HTMLElement} context \n\t * @param {HTMLElement} elem \n\t * @param {AnimatorRect} rect \n\t * @param {string} animationId \n\t */\n\tgetChildren = (context, elem, rect, animationId) => {\n\t\tif (Array.isArray(this.animations[animationId])) {\n\t\t\treturn [];\n\t\t}\n\t\t\n\t\tconst children = (this.animations[animationId] && this.animations[animationId].children) || [];\n\n\t\treturn children.reduce((c, anim) => {\n\t\t\tconst arr = Array.from(elem.querySelectorAll(anim.selector));\n\t\t\t\n\t\t\tarr.forEach((el) => {\n\t\t\t\tconst keyframes = this.getKeyframes(elem, rect, null, anim.props, el);\n\t\t\t\t\n\t\t\t\tc.push({\n\t\t\t\t\tnode: el,\n\t\t\t\t\tparent: elem,\n\t\t\t\t\tcontext,\n\t\t\t\t\tease: anim.ease,\n\t\t\t\t\tis3DMatrix: this.is3DMatrix(animationId),\n\t\t\t\t\tkeyframes,\n\t\t\t\t\tkeys: Object.keys(keyframes),\n\t\t\t\t\tinitialMatrix: getInitialMatrix(el, this.is3DMatrix(animationId)),\n\t\t\t\t});\n\t\t\t});\n\t\t\treturn c;\n\t\t}, []);\n\t}\n\n\t/**\n\t * @param {array} list \n\t * @param {HTMLElement} elem \n\t */\n\tparseElements = (list, elem) => {\n\t\tconst context = this.getContext(elem);\n\t\tconst animationId = elem.getAttribute(ATTR_NAME);\n\n\t\tconst rect = this.getRect(context, elem);\n\n\t\telemGuid(elem);\n\n\t\tconst keyframes = this.getKeyframes(elem, rect, animationId);\n\n\t\tconst props = {\n\t\t\tnode: elem,\n\t\t\tcontext,\n\t\t\tis3DMatrix: this.is3DMatrix(animationId),\n\t\t\tease: this.getEase(animationId),\n\t\t\tkeyframes,\n\t\t\tkeys: Object.keys(keyframes),\n\t\t\tinitialMatrix: getInitialMatrix(elem, this.is3DMatrix(animationId)),\n\t\t};\n\t\tlist.push(props);\n\n\t\treturn list.concat(this.getChildren(context, elem, rect, animationId));\n\t}\n\n\t/**\n\t * @param {HTMLElement} ctx\n\t */\n\tupdateContext = (ctx) => {\n\t\tconst id = elemGuid(ctx);\n\t\tconst context = ctx.tagName === 'HTML' ? window : ctx;\n\t\tif (this.handlerDictionnary[id]) {\n\t\t\tcontext.removeEventListener('scroll', this.handlerDictionnary[id]);\n\t\t} else {\n\t\t\tthis.handlerDictionnary[id] = () => { this.scroll(ctx); };\n\t\t}\n\t\t\n\t\tcontext.addEventListener('scroll', this.handlerDictionnary[id]);\n\n\t\tthis.handlerDictionnary[id](ctx);\n\t};\n\n\tupdateElements = () => {\n\t\tupdateScreen();\n\t\tthis.contexts = [];\n\t\tconst nodeList = document.querySelectorAll(`[${ATTR_NAME}]`);\n\t\tthis.elements = Array.from(nodeList).reduce(this.parseElements, []);\n\n\t\tthis.contexts.forEach(this.updateContext);\n\t};\n\n\t/**\n\t * @param {array} anims\n\t */\n\tsetAnimations = (anims) => {\n\t\tthis.animations = anims;\n\t\tthis.updateElements();\n\t};\n\n\t/* eslint-disable no-console */\n\tdebug = () => {\n\t\tconsole.log('animations', this.animations);\n\t\tconsole.log('all elements', this.elements);\n\t\tconsole.log('filtered elements', this.elements.filter(x => x.keys.length > 0));\n\t\tconsole.log('contexts', this.contexts);\n\t};\n}\n\n// @ts-ignore\nwindow.__Animator = Animator; // eslint-disable-line\n","import { ELEM_TOP, ELEM_CENTER, ELEM_BOTTOM } from '../Constants';\nimport { screen } from '../utils/screen';\n\n/**\n * @param {AnimatorRect} rect \n * @param {string} when \n */\nexport default function parseWhen(rect, when) {\n\tconst parts = when.split('_');\n\tif (parts.length !== 2) throw new Error('Missing parameters in animation \"when\" (expects: ELEM_* | SCREEN_*)');\n\n\tlet obj;\n\tswitch (parts[0]) {\n\t\tdefault:\n\t\tcase ELEM_TOP: obj = rect.top; break;\n\t\tcase ELEM_CENTER: obj = rect.top + (rect.height / 2); break;\n\t\tcase ELEM_BOTTOM: obj = rect.top + rect.height; break;\n\t}\n\n\treturn obj - screen[parts[1]];\n}\n","import {\n\ttoCSS,\n\tcomposeMultiple,\n\ttranslate,\n\trotate,\n\tscale,\n} from '../utils/CssMatrix';\nimport valueOrDefault from './valueOrDefault';\n\n/**\n * @param {array} initialMatrix \n * @param {object} values\n */\nexport default function matrix(initialMatrix, values) {\n\tif (\n\t\tvalues.rotation !== undefined\n\t\t|| values.scaleX !== undefined\n\t\t|| values.scaleY !== undefined\n\t\t|| values.x !== undefined\n\t\t|| values.y !== undefined\n\t\t|| values.z !== undefined\n\t) {\n\t\tvalues.transform = toCSS(composeMultiple([\n\t\t\tinitialMatrix,\n\t\t\ttranslate(valueOrDefault(values.x), valueOrDefault(values.y), valueOrDefault(values.z)),\n\t\t\trotate(valueOrDefault(values.rotation)),\n\t\t\tscale(valueOrDefault(values.scaleX, 1), valueOrDefault(values.scaleY, 1), valueOrDefault(values.scaleZ, 1)),\n\t\t]));\n\t}\n\n\tdelete values.rotation;\n\tdelete values.scaleX;\n\tdelete values.scaleY;\n\tdelete values.x;\n\tdelete values.y;\n\tdelete values.z;\n\treturn values;\n}\n","import transform2d from './transform2d';\nimport transformValues from './transformValues';\nimport { isIdentity2d } from '../utils/CssMatrix';\n\n/**\n * @param {HTMLElement} el \n * @param {Number} st \n */\nexport default function calculate2dTransforms(el, st) {\n\tconst v = transform2d(transformValues(el, st));\n\tif (v.transform && el.initialMatrix && !isIdentity2d(el.initialMatrix)) {\n\t\tconst [a, b, c, d, tx, ty] = el.initialMatrix;\n\n\t\tconst scaleX = Math.sign(a) * Math.sqrt((a * a) + (b * b));\n\t\tconst scaleY = Math.sign(d) * Math.sqrt((c * c) + (d * d));\n\t\tconst rotation = Math.atan2(-b, a);\n\n\t\tv.transform += ' ' + transform2d({\n\t\t\tscaleX,\n\t\t\tscaleY,\n\t\t\trotation,\n\t\t\tx:\n\t\t\ttx,\n\t\t\ty: ty,\n\t\t}).transform;\n\t}\n\n\treturn v;\n}\n"],"names":["elemGuid","element","id","getAttribute","Math","random","toString","substring","setAttribute","const","SCREEN_BOTTOM","SCREEN_TOP","SCREEN_CENTER","screen","updateScreen","window","innerHeight","parseVal","prop","value","elem","matches","match","val","parseFloat","innerWidth","rect","getBoundingClientRect","height","width","parseRelativeVal","getContextScrollTop","context","ctx","tagName","document","scrollingElement","scrollTop","valueOrDefault","defaultValue","undefined","smallest","precision","transform2d","values","rotation","scaleX","scaleY","x","y","z","t","r","s","transform","constrain","num","min","max","n","parseInt","easeInQuad","b","c","d","easeOutQuad","easeInOutQuad","easeInCubic","easeOutCubic","easeInOutCubic","easeInQuart","easeOutQuart","easeInOutQuart","easeInQuint","easeOutQuint","easeInOutQuint","easeInSine","cos","PI","easeOutSine","sin","easeInOutSine","easeInExpo","pow","easeOutExpo","easeInOutExpo","easeInCirc","sqrt","easeOutCirc","easeInOutCirc","easeInElastic","p","a","abs","asin","easeOutElastic","easeInOutElastic","easeInBack","easeOutBack","easeInOutBack","easeInBounce","jQuery","easing","easeOutBounce","easeInOutBounce","map","in_min","in_max","out_min","out_max","constrainValues","constrained","st","startOffset","endOffset","prc","key","ease","Easings","startValue","endValue","transformValues","el","keys","propKey","Object","keyframes","reduce","propCarry","propVal","i","offset","i2d","i3d","translate","scale","w","h","rotate","composeMultiple","matrices","result","a00","a01","a02","a03","a10","a11","a12","a13","a20","a21","a22","a23","a30","a31","a32","a33","b0","b1","b2","b3","inputMatrix","length","getInitialMatrix","is3D","prev","style","getComputedStyle","getPropertyValue","m","replace","split","trim","matrix2dto3d","Animator","constructor","animations","elements","contexts","handlerDictionnary","loopDictionnary","lastValuesDictionnary","animatorTopDictionnary","getKeyframes","animationId","props","child","animation","this","Array","isArray","anim","when","from","obj","parts","Error","top","parseWhen","c2","push","getRect","getContext","parentElement","find","hasChanged","JSON","stringify","scroll","cancelAnimationFrame","requestAnimationFrame","update","virtualScroll","forEach","node","namespaceURI","indexOf","is3DMatrix","initialMatrix","scaleZ","join","matrix","v","every","sign","atan2","tx","ty","calculate2dTransforms","assign","getEase","force3d","getChildren","children","querySelectorAll","selector","parent","parseElements","list","concat","updateContext","removeEventListener","addEventListener","updateElements","nodeList","setAnimations","anims","debug","console","log","filter","instances","updateAll","instance","getConstants","Constants","__Animator"],"mappings":"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"}