{"version":3,"file":"animator.mjs","sources":["../src/utils/guid.js","../src/utils/Easings.js","../src/utils/CssMatrix.js","../src/utils/constrain.js","../src/utils/map.js","../src/index.js"],"sourcesContent":["//@ts-check\n\nexport function guid() {\n\treturn Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);\n}\n\n/**\n * @param {HTMLElement} element\n * @returns {string}\n */\nexport function elemGuid(element) {\n\tlet id = element.getAttribute('data-guid');\n\tif (!id) {\n\t\tid = guid();\n\t\telement.setAttribute('data-guid', id);\n\t}\n\treturn id;\n}\n","/* eslint-disable */\n\nexport default {\n\teaseInQuad(t, b, c, d) {\n\t\treturn c * (t /= d) * t + b;\n\t},\n\teaseOutQuad(t, b, c, d) {\n\t\treturn -c * (t /= d) * (t - 2) + b;\n\t},\n\teaseInOutQuad(t, b, c, d) {\n\t\tif ((t /= d / 2) < 1) return c / 2 * t * t + b;\n\t\treturn -c / 2 * ((--t) * (t - 2) - 1) + b;\n\t},\n\teaseInCubic(t, b, c, d) {\n\t\treturn c * (t /= d) * t * t + b;\n\t},\n\teaseOutCubic(t, b, c, d) {\n\t\treturn c * ((t = t / d - 1) * t * t + 1) + b;\n\t},\n\teaseInOutCubic(t, b, c, d) {\n\t\tif ((t /= d / 2) < 1) return c / 2 * t * t * t + b;\n\t\treturn c / 2 * ((t -= 2) * t * t + 2) + b;\n\t},\n\teaseInQuart(t, b, c, d) {\n\t\treturn c * (t /= d) * t * t * t + b;\n\t},\n\teaseOutQuart(t, b, c, d) {\n\t\treturn -c * ((t = t / d - 1) * t * t * t - 1) + b;\n\t},\n\teaseInOutQuart(t, b, c, d) {\n\t\tif ((t /= d / 2) < 1) return c / 2 * t * t * t * t + b;\n\t\treturn -c / 2 * ((t -= 2) * t * t * t - 2) + b;\n\t},\n\teaseInQuint(t, b, c, d) {\n\t\treturn c * (t /= d) * t * t * t * t + b;\n\t},\n\teaseOutQuint(t, b, c, d) {\n\t\treturn c * ((t = t / d - 1) * t * t * t * t + 1) + b;\n\t},\n\teaseInOutQuint(t, b, c, d) {\n\t\tif ((t /= d / 2) < 1) return c / 2 * t * t * t * t * t + b;\n\t\treturn c / 2 * ((t -= 2) * t * t * t * t + 2) + b;\n\t},\n\teaseInSine(t, b, c, d) {\n\t\treturn -c * Math.cos(t / d * (Math.PI / 2)) + c + b;\n\t},\n\teaseOutSine(t, b, c, d) {\n\t\treturn c * Math.sin(t / d * (Math.PI / 2)) + b;\n\t},\n\teaseInOutSine(t, b, c, d) {\n\t\treturn -c / 2 * (Math.cos(Math.PI * t / d) - 1) + b;\n\t},\n\teaseInExpo(t, b, c, d) {\n\t\treturn (t == 0) ? b : c * Math.pow(2, 10 * (t / d - 1)) + b;\n\t},\n\teaseOutExpo(t, b, c, d) {\n\t\treturn (t == d) ? b + c : c * (-Math.pow(2, -10 * t / d) + 1) + b;\n\t},\n\teaseInOutExpo(t, b, c, d) {\n\t\tif (t == 0) return b;\n\t\tif (t == d) return b + c;\n\t\tif ((t /= d / 2) < 1) return c / 2 * Math.pow(2, 10 * (t - 1)) + b;\n\t\treturn c / 2 * (-Math.pow(2, -10 * --t) + 2) + b;\n\t},\n\teaseInCirc(t, b, c, d) {\n\t\treturn -c * (Math.sqrt(1 - (t /= d) * t) - 1) + b;\n\t},\n\teaseOutCirc(t, b, c, d) {\n\t\treturn c * Math.sqrt(1 - (t = t / d - 1) * t) + b;\n\t},\n\teaseInOutCirc(t, b, c, d) {\n\t\tif ((t /= d / 2) < 1) return -c / 2 * (Math.sqrt(1 - t * t) - 1) + b;\n\t\treturn c / 2 * (Math.sqrt(1 - (t -= 2) * t) + 1) + b;\n\t},\n\teaseInElastic(t, b, c, d) {\n\t\tvar s = 1.70158; let p = 0; let a = c;\n\t\tif (t == 0) return b; if ((t /= d) == 1) return b + c; if (!p) p = d * 0.3;\n\t\tif (a < Math.abs(c)) { a = c; var s = p / 4; }\t\telse var s = p / (2 * Math.PI) * Math.asin(c / a);\n\t\treturn -(a * Math.pow(2, 10 * (t -= 1)) * Math.sin((t * d - s) * (2 * Math.PI) / p)) + b;\n\t},\n\teaseOutElastic(t, b, c, d) {\n\t\tvar s = 1.70158; let p = 0; let a = c;\n\t\tif (t == 0) return b; if ((t /= d) == 1) return b + c; if (!p) p = d * 0.3;\n\t\tif (a < Math.abs(c)) { a = c; var s = p / 4; }\t\telse var s = p / (2 * Math.PI) * Math.asin(c / a);\n\t\treturn a * Math.pow(2, -10 * t) * Math.sin((t * d - s) * (2 * Math.PI) / p) + c + b;\n\t},\n\teaseInOutElastic(t, b, c, d) {\n\t\tvar s = 1.70158; let p = 0; let a = c;\n\t\tif (t == 0) return b; if ((t /= d / 2) == 2) return b + c; if (!p) p = d * (0.3 * 1.5);\n\t\tif (a < Math.abs(c)) { a = c; var s = p / 4; }\t\telse var s = p / (2 * Math.PI) * Math.asin(c / a);\n\t\tif (t < 1) return -0.5 * (a * Math.pow(2, 10 * (t -= 1)) * Math.sin((t * d - s) * (2 * Math.PI) / p)) + b;\n\t\treturn a * Math.pow(2, -10 * (t -= 1)) * Math.sin((t * d - s) * (2 * Math.PI) / p) * 0.5 + c + b;\n\t},\n\teaseInBack(t, b, c, d, s) {\n\t\tif (s == undefined) s = 1.70158;\n\t\treturn c * (t /= d) * t * ((s + 1) * t - s) + b;\n\t},\n\teaseOutBack(t, b, c, d, s) {\n\t\tif (s == undefined) s = 1.70158;\n\t\treturn c * ((t = t / d - 1) * t * ((s + 1) * t + s) + 1) + b;\n\t},\n\teaseInOutBack(t, b, c, d, s) {\n\t\tif (s == undefined) s = 1.70158; \n\t\tif ((t /= d / 2) < 1) return c / 2 * (t * t * (((s *= (1.525)) + 1) * t - s)) + b;\n\t\treturn c / 2 * ((t -= 2) * t * (((s *= (1.525)) + 1) * t + s) + 2) + b;\n\t},\n\teaseInBounce(t, b, c, d) {\n\t\treturn c - jQuery.easing.easeOutBounce(d - t, 0, c, d) + b;\n\t},\n\teaseOutBounce(t, b, c, d) {\n\t\tif ((t /= d) < (1 / 2.75)) {\n\t\t\treturn c * (7.5625 * t * t) + b;\n\t\t} else if (t < (2 / 2.75)) {\n\t\t\treturn c * (7.5625 * (t -= (1.5 / 2.75)) * t + 0.75) + b;\n\t\t} else if (t < (2.5 / 2.75)) {\n\t\t\treturn c * (7.5625 * (t -= (2.25 / 2.75)) * t + 0.9375) + b;\n\t\t} \n\t\treturn c * (7.5625 * (t -= (2.625 / 2.75)) * t + 0.984375) + b;\n\t\t\n\t},\n\teaseInOutBounce(t, b, c, d) {\n\t\tif (t < d / 2) return jQuery.easing.easeInBounce(t * 2, 0, c, d) * 0.5 + b;\n\t\treturn jQuery.easing.easeOutBounce(t * 2 - d, 0, c, d) * 0.5 + c * 0.5 + b;\n\t},\n};","export function identity() {\n\treturn [\n\t\t1, 0, 0, 0,\n\t\t0, 1, 0, 0,\n\t\t0, 0, 1, 0,\n\t\t0, 0, 0, 1,\n\t];\n}\n\nexport function translate(x, y, z) {\n\treturn [\n\t\t1, 0, 0, 0,\n\t\t0, 1, 0, 0,\n\t\t0, 0, 1, 0,\n\t\tx, y, z, 1,\n\t];\n}\n\nexport function scale(w, h, d) {\n\treturn [\n\t\tw, 0, 0, 0,\n\t\t0, h, 0, 0,\n\t\t0, 0, d, 0,\n\t\t0, 0, 0, 1,\n\t];\n}\n\nexport function rotate(a) {\n\n\treturn [\n\t\tMath.cos(a), -Math.sin(a), 0, 0,\n\t\tMath.sin(a), Math.cos(a), 0, 0,\n\t\t0, 0, 1, 0,\n\t\t0, 0, 0, 1,\n\t];\n}\n\nexport function toCSS(array) {\n\treturn 'matrix3d(' + array.join(',') + ')';\n}\n\nexport function fromString(string) {\n\treturn string.replace(/matrix(?:3d)?\\(/i, '').replace(')', '').split(',').map(x => parseFloat(x.trim()));\n}\n\n// export function fromString(string) {\n// \tconst parsed = string.match(matrixRegex);\n// \tif (parsed === null || parsed.length < 7) throw new Error(`'${string}' is not a matrix`);\n// \treturn {\n// \t\ta: parseFloat(parsed[1]),\n// \t\tb: parseFloat(parsed[2]),\n// \t\tc: parseFloat(parsed[3]),\n// \t\td: parseFloat(parsed[4]),\n// \t\te: parseFloat(parsed[5]),\n// \t\tf: parseFloat(parsed[6]),\n// \t};\n// }\n\nexport function matrix2dto3d(m) {\n\tif (m.length === 16) return m;\n\tconst n = composeMultiple([\n\t\tidentity(),\n\t\ttranslate(m[4], m[5], 0),\n\t\trotate(0),\n\t\tscale(m[0], m[3], 1),\n\t]);\n\treturn n;\n}\n\nexport function compose(a, b) {\n\tconst result = [];\n\n\tconst a00 = a[0];\n\tconst a01 = a[1];\n\tconst a02 = a[2];\n\tconst a03 = a[3];\n\tconst a10 = a[4];\n\tconst a11 = a[5];\n\tconst a12 = a[6];\n\tconst a13 = a[7];\n\tconst a20 = a[8];\n\tconst a21 = a[9];\n\tconst a22 = a[10];\n\tconst a23 = a[11];\n\tconst a30 = a[12];\n\tconst a31 = a[13];\n\tconst a32 = a[14];\n\tconst a33 = a[15];\n\n\t// Cache only the current line of the second matrix\n\tlet b0 = b[0];\n\tlet b1 = b[1];\n\tlet b2 = b[2];\n\tlet b3 = b[3];\n\tresult[0] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n\tresult[1] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n\tresult[2] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n\tresult[3] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n\n\tb0 = b[4]; b1 = b[5]; b2 = b[6]; b3 = b[7]; //eslint-disable-line\n\tresult[4] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n\tresult[5] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n\tresult[6] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n\tresult[7] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n\n\tb0 = b[8]; b1 = b[9]; b2 = b[10]; b3 = b[11]; //eslint-disable-line\n\tresult[8] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n\tresult[9] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n\tresult[10] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n\tresult[11] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n\n\tb0 = b[12]; b1 = b[13]; b2 = b[14]; b3 = b[15]; //eslint-disable-line\n\tresult[12] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n\tresult[13] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n\tresult[14] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n\tresult[15] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n\n\treturn result;\n}\n\nexport function composeMultiple(matrices) {\n\tlet inputMatrix = matrices[0];\n\n\tfor (let i = 1; i < matrices.length; i += 1) {\n\t\tinputMatrix = compose(inputMatrix, matrices[i]);\n\t}\n\n\treturn inputMatrix;\n}\n","/**\n * Limits a number between a range of 2 numbers\n * @param {(string|number)} num \n * @param {number} min \n * @param {number} max \n */\nexport const constrain = (num, min, max) => {\n\tconst n = typeof num === 'string' ? parseInt(num, 10) : num;\n\treturn Math.min(Math.max(n, min), max);\n};\n","/**\n * Map a number between two ranges\n * \n * @param {number} num \n * @param {number} in_min \n * @param {number} in_max \n * @param {number} out_min \n * @param {number} out_max \n */\nexport const map = (num, in_min, in_max, out_min, out_max) => {\n\tif (in_max === in_min) return out_max;\n\treturn (((num - in_min) * (out_max - out_min)) / (in_max - in_min)) + out_min;\n};\n","//@ts-check\n\n// import 'core-js/fn/array/find';\n\nimport { elemGuid } from './utils/guid';\nimport Ease from './utils/Easings';\nimport {\n\tscale,\n\trotate,\n\ttranslate,\n\ttoCSS,\n\tfromString,\n\tidentity,\n\tcomposeMultiple,\n\tmatrix2dto3d,\n} from './utils/CssMatrix';\nimport { constrain } from './utils/constrain';\nimport { map } from './utils/map';\n\n/**\n * @typedef {object} AnimatorElement\n * @property {HTMLElement} context\n * @property {string} ease\n * @property {array} initialMatrix\n * @property {object} keyframes\n * @property {array} keys\n * @property {HTMLElement} node\n */\n\n/**\n * @typedef {object} AnimatorProp\n * @property {string} ease\n * @property {number} endOffset\n * @property {number} endValue\n * @property {string} key\n * @property {number} st\n * @property {number} startOffset\n * @property {number} startValue\n */\n\n/**\n * @typedef {object} AnimatorRect\n * @property {number} top\n * @property {number} height\n */\n\nexport const ELEM_BOTTOM = 'eb';\nexport const ELEM_TOP = 'et';\nexport const ELEM_CENTER = 'ec';\n\nexport const SCREEN_BOTTOM = 'sb';\nexport const SCREEN_TOP = 'st';\nexport const SCREEN_CENTER = 'sc';\n\nconst instances = [];\n\nexport function updateAll() {\n\tinstances.forEach((instance) => {\n\t\tinstance.updateElements();\n\t});\n}\n\nconst updateScreen = () => {\n\tscreen = {\n\t\t[SCREEN_TOP]: 0,\n\t\t[SCREEN_CENTER]: (window.innerHeight / 2),\n\t\t[SCREEN_BOTTOM]: window.innerHeight,\n\t};\n};\n\nfunction valueOrDefault(value, defaultValue = 0) {\n\treturn value !== undefined ? value : defaultValue;\n}\n\nlet screen;\nupdateScreen();\n\n// @ts-ignore\nwindow.__animators = instances; //eslint-disable-line\n\nexport function Animator() {\n\tlet animations = [];\n\tlet elements = [];\n\tlet contexts = [];\n\n\tconst handlerDictionnary = {};\n\tconst loopDictionnary = {};\n\tconst lastValuesDictionnary = {};\n\tconst animatorTopDictionnary = {};\n\n\tinstances.push(this);\n\n\t/**\n\t * @param {Element} context \n\t */\n\tfunction getContextScrollTop(context) {\n\t\tlet ctx = context;\n\t\tif (context.tagName === 'HTML') ctx = document.scrollingElement || context;\n\t\treturn ctx.scrollTop;\n\t}\n\n\t/**\n\t * @param {HTMLElement} context \n\t * @param {AnimatorRect} rect \n\t * @param {string} when \n\t */\n\tfunction parseWhen(context, rect, when) {\n\t\tconst parts = when.split('_');\n\t\tif (parts.length !== 2) throw new Error('Missing parameters in animation \"when\" (expects: ELEM_* | SCREEN_*)');\n\n\t\tlet obj;\n\t\tswitch (parts[0]) {\n\t\t\tdefault:\n\t\t\tcase ELEM_TOP: obj = rect.top; break;\n\t\t\tcase ELEM_CENTER: obj = rect.top + (rect.height / 2); break;\n\t\t\tcase ELEM_BOTTOM: obj = rect.top + rect.height; break;\n\t\t}\n\n\t\treturn obj - screen[parts[1]];\n\t}\n\n\t/**\n\t * @param {string} prop \n\t * @param {number} value \n\t * @param {HTMLElement} elem \n\t */\n\tfunction parseRelativeVal(prop, value, elem) {\n\t\tswitch (prop) {\n\t\t\tcase 'y': return (value / 100) * elem.clientHeight;\n\t\t\tcase 'x':\n\t\t\tdefault: return (value / 100) * elem.clientWidth;\n\t\t}\n\t}\n\n\t/**\n\t * @param {string} prop \n\t * @param {string} value \n\t * @param {HTMLElement} elem \n\t */\n\tfunction parseVal(prop, value, elem) {\n\t\tif (typeof value === 'number') return value;\n\n\t\tconst matches = value.match(/([-0-9.]+)(.+)/);\n\t\tconst val = parseFloat(matches[1]);\n\t\tconst unit = matches[2];\n\n\t\tswitch (unit) {\n\t\t\tcase 'vh': return (val / 100) * window.innerHeight;\n\t\t\tcase 'vw': return (val / 100) * window.innerWidth;\n\t\t\tcase 'px': return val;\n\t\t\tcase '%':\n\t\t\tdefault: return parseRelativeVal(prop, val, elem);\n\t\t}\n\t}\n\n\t/**\n\t * @param {HTMLElement} context \n\t * @param {HTMLElement} elem \n\t * @param {AnimatorRect} rect \n\t * @param {string} animationId \n\t * @param {object} props \n\t * @param {HTMLElement} child\n\t */\n\tfunction getKeyframes(context, elem, rect, animationId, props = null, child = null) {\n\t\tlet animation = animations[animationId];\n\n\t\tif (props) {\n\t\t\tanimation = props;\n\t\t} else if (animation && !Array.isArray(animation)) {\n\t\t\tanimation = animation.props;\n\t\t}\n\n\t\tif (!animation) return {};\n\t\treturn animation.reduce((c, anim) => {\n\t\t\tlet values = { ...anim };\n\t\t\tdelete values.when;\n\t\t\tvalues = Object.keys(values).map(key => [key, anim[key]]);\n\t\t\tconst from = parseWhen(context, rect, anim.when);\n\n\t\t\treturn values.reduce((c2, value) => {\n\t\t\t\tconst [key, val] = value;\n\t\t\t\tc2[key] = c[key] || [];\n\t\t\t\tc2[key].push([from, parseVal(key, val, child || elem)]);\n\t\t\t\treturn c2;\n\t\t\t}, c);\n\t\t}, {});\n\t}\n\n\t/**\n\t * @param {HTMLElement} context \n\t * @param {HTMLElement} elem \n\t * @returns {AnimatorRect}\n\t */\n\tfunction getRect(context, elem) {\n\t\tconst style = elem.getAttribute('style');\n\t\telem.setAttribute('style', '');\n\t\tconst { top, height } = elem.getBoundingClientRect();\n\t\tconst st = getContextScrollTop(context);\n\t\tconst id = elemGuid(context);\n\t\telem.setAttribute('style', style);\n\n\t\treturn {\n\t\t\ttop: (top - animatorTopDictionnary[id]) + st,\n\t\t\theight,\n\t\t};\n\t}\n\n\t/**\n\t * @param {HTMLElement} elem \n\t */\n\tfunction getContext(elem) {\n\t\tlet context = null;\n\t\tlet el = elem;\n\n\t\twhile (el.parentElement && !context) {\n\t\t\tel = el.parentElement;\n\t\t\tif (el.getAttribute('data-scrollbar') || el.getAttribute('data-scrollbar') === '') {\n\t\t\t\tcontext = el;\n\t\t\t}\n\t\t}\n\t\tif (!contexts.find(ctx => context === ctx)) {\n\t\t\tconst id = elemGuid(context);\n\t\t\tanimatorTopDictionnary[id] = el.getBoundingClientRect().top + el.scrollTop;\n\t\t\tcontexts.push(context);\n\t\t}\n\t\treturn context;\n\t}\n\n\t/**\n\t * @param {object} c \n\t * @param {AnimatorProp} prop \n\t */\n\tfunction constrainValues(c, prop) {\n\t\tconst constrained = constrain(prop.st, prop.startOffset, prop.endOffset);\n\t\tconst prc = map(constrained, prop.startOffset, prop.endOffset, 0, 1);\n\t\tif (prop.ease) {\n\t\t\tc[prop.key] = Ease[prop.ease](prc, prop.startValue, prop.endValue - prop.startValue, 1);\n\t\t} else {\n\t\t\tc[prop.key] = map(constrained, prop.startOffset, prop.endOffset, prop.startValue, prop.endValue);\n\t\t}\n\t\treturn c;\n\t}\n\n\t/**\n\t * @param {AnimatorElement} el\n\t * @param {number} st\n\t */\n\tfunction transformValues(el, st) {\n\t\treturn el.keys.map((propKey) => {\n\t\t\treturn {\n\t\t\t\tst,\n\t\t\t\tease: el.ease,\n\t\t\t\tkey: propKey,\n\t\t\t\t...el.keyframes[propKey]\n\t\t\t\t\t.reduce((propCarry, propVal, i) => {\n\t\t\t\t\t\tconst [offset, value] = propVal;\n\n\t\t\t\t\t\tswitch (i) {\n\t\t\t\t\t\t\tcase 0: \n\t\t\t\t\t\t\t\tpropCarry.startOffset = offset;\n\t\t\t\t\t\t\t\tpropCarry.startValue = value;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 1:\n\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\tpropCarry.endOffset = offset;\n\t\t\t\t\t\t\t\tpropCarry.endValue = value;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\treturn propCarry;\n\t\t\t\t\t}, {}),\n\t\t\t};\n\t\t}).reduce(constrainValues, {});\n\t}\n\n\t/**\n\t * @param {string} id\n\t * @param {object} values \n\t */\n\tconst hasChanged = (id, values) => {\n\t\tif (!lastValuesDictionnary[id]) return true;\n\t\treturn lastValuesDictionnary[id] !== JSON.stringify(values);\n\t};\n\n\t/**\n\t * @param {HTMLElement} ctx \n\t */\n\tconst scroll = (ctx) => {\n\t\tconst id = elemGuid(ctx);\n\t\tconst st = getContextScrollTop(ctx);\n\t\tif (loopDictionnary[id]) {\n\t\t\tcancelAnimationFrame(loopDictionnary[id]);\n\t\t}\n\t\t\n\t\tloopDictionnary[id] = requestAnimationFrame(() => {\n\t\t\tupdate(ctx, st);\n\t\t});\n\t};\n\n\t/**\n\t * @param {array} initialMatrix \n\t * @param {object} values\n\t */\n\tfunction matrix(initialMatrix, values) {\n\t\tif (\n\t\t\tvalues.rotation !== undefined\n\t\t\t|| values.scaleX !== undefined\n\t\t\t|| values.scaleY !== undefined\n\t\t\t|| values.x !== undefined\n\t\t\t|| values.y !== undefined\n\t\t\t|| values.z !== undefined\n\t\t) {\n\t\t\tvalues.transform = toCSS(composeMultiple([\n\t\t\t\tinitialMatrix,\n\t\t\t\ttranslate(valueOrDefault(values.x), valueOrDefault(values.y), valueOrDefault(values.z)),\n\t\t\t\trotate(valueOrDefault(values.rotation)),\n\t\t\t\tscale(valueOrDefault(values.scaleX, 1), valueOrDefault(values.scaleY, 1), valueOrDefault(values.scaleZ, 1)),\n\t\t\t]));\n\t\t}\n\n\t\tdelete values.rotation;\n\t\tdelete values.scaleX;\n\t\tdelete values.scaleY;\n\t\tdelete values.x;\n\t\tdelete values.y;\n\t\tdelete values.z;\n\t\treturn values;\n\t}\n\n\n\t/**\n\t * @param {object} values\n\t */\n\tfunction transform2d(values) {\n\t\tif (\n\t\t\tvalues.rotation !== undefined\n\t\t\t|| values.scaleX !== undefined\n\t\t\t|| values.scaleY !== undefined\n\t\t\t|| values.x !== undefined\n\t\t\t|| values.y !== undefined\n\t\t\t|| values.z !== undefined\n\t\t) {\n\t\t\tconst t = `translate(${valueOrDefault(values.x, 0)}px, ${valueOrDefault(values.y, 0)}px)`;\n\t\t\tconst r = `rotate(${valueOrDefault(values.rotation, 0)}deg)`;\n\t\t\tconst s = `scale(${valueOrDefault(values.scaleX, 1)}, ${valueOrDefault(values.scaleY, 1)})`;\n\n\t\t\tvalues.transform = `${t} ${r} ${s}`;\n\t\t}\n\t\t\n\t\tdelete values.rotation;\n\t\tdelete values.scaleX;\n\t\tdelete values.scaleY;\n\t\tdelete values.x;\n\t\tdelete values.y;\n\t\tdelete values.z;\n\t\treturn values;\n\t}\n\n\t/**\n\t * @param {HTMLElement} ctx \n\t * @param {number} st \n\t */\n\tfunction update(ctx, st) {\n\t\telements.forEach((el) => {\n\t\t\tif (el.context !== ctx || Object.keys(el.keyframes).length === 0) return;\n\t\t\t\n\t\t\tconst isSVG = ~el.node.namespaceURI.indexOf('svg');\n\t\t\tlet values = null;\n\t\t\tif (isSVG) {\n\t\t\t\tvalues = transform2d(transformValues(el, st));\n\t\t\t} else if (el.is3DMatrix || (el.initialMatrix && el.initialMatrix.length === 16)) {\n\t\t\t\tvalues = matrix(el.initialMatrix, transformValues(el, st));\n\t\t\t} else {\n\t\t\t\tvalues = transform2d(transformValues(el, st));\n\t\t\t\tif (values.transform && el.initialMatrix) {\n\t\t\t\t\tconst [a, b, c, d, tx, ty] = el.initialMatrix;\n\n\t\t\t\t\tconst scaleX = Math.sign(a) * Math.sqrt((a * a) + (b * b));\n\t\t\t\t\tconst scaleY = Math.sign(d) * Math.sqrt((c * c) + (d * d));\n\t\t\t\t\tconst rotation = Math.atan2(-b, a);\n\n\t\t\t\t\tvalues.transform += ' ' + transform2d({\n\t\t\t\t\t\tscaleX,\n\t\t\t\t\t\tscaleY,\n\t\t\t\t\t\trotation,\n\t\t\t\t\t\tx:\n\t\t\t\t\t\ttx,\n\t\t\t\t\t\ty: ty,\n\t\t\t\t\t}).transform;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst id = elemGuid(el.node);\n\t\t\tif (hasChanged(id, values)) {\n\t\t\t\tObject.assign(el.node.style, values);\n\t\t\t\tlastValuesDictionnary[id] = JSON.stringify(values);\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * @param {HTMLElement} elem \n\t */\n\tfunction getInitialMatrix(elem, is3D = false) {\n\t\tconst prev = elem.style.transform;\n\t\telem.style.transform = '';\n\t\tconst transform = window.getComputedStyle(elem).getPropertyValue('transform');\n\t\telem.style.transform = prev;\n\t\t\n\t\tif (transform === 'none') return null;\n\n\t\tlet m = fromString(transform);\n\t\tm = (m.length < 16 && is3D) ? matrix2dto3d(m) : m;\n\t\t\n\t\treturn m;\n\t}\n\n\t/**\n\t * @param {string} animationId \n\t */\n\tfunction getEase(animationId) {\n\t\treturn (animations[animationId] && animations[animationId].ease) || null;\n\t}\n\n\t/**\n\t * @param {string} animationId \n\t */\n\tfunction is3DMatrix(animationId) {\n\t\treturn (animations[animationId] && animations[animationId].force3d) || false;\n\t}\n\n\t/**\n\t * @param {HTMLElement} context \n\t * @param {HTMLElement} elem \n\t * @param {AnimatorRect} rect \n\t * @param {string} animationId \n\t */\n\tfunction getChildren(context, elem, rect, animationId) {\n\t\tif (Array.isArray(animations[animationId])) {\n\t\t\treturn [];\n\t\t}\n\t\t\n\t\tconst children = (animations[animationId] && animations[animationId].children) || [];\n\n\t\treturn children.reduce((c, anim) => {\n\t\t\tconst arr = Array.from(elem.querySelectorAll(anim.selector));\n\t\t\t\n\t\t\tarr.forEach((el) => {\n\t\t\t\tconst keyframes = getKeyframes(context, elem, rect, null, anim.props, el);\n\t\t\t\t\n\t\t\t\tc.push({\n\t\t\t\t\tnode: el,\n\t\t\t\t\tparent: elem,\n\t\t\t\t\tcontext,\n\t\t\t\t\tease: anim.ease,\n\t\t\t\t\tis3DMatrix: is3DMatrix(animationId),\n\t\t\t\t\tkeyframes,\n\t\t\t\t\tkeys: Object.keys(keyframes),\n\t\t\t\t\tinitialMatrix: getInitialMatrix(el, is3DMatrix(animationId)),\n\t\t\t\t});\n\t\t\t});\n\t\t\treturn c;\n\t\t}, []);\n\t}\n\n\t/**\n\t * @param {array} list \n\t * @param {HTMLElement} elem \n\t */\n\tfunction parseElements(list, elem) {\n\t\tconst context = getContext(elem);\n\t\tconst animationId = elem.getAttribute('data-animator-id');\n\n\t\tconst rect = getRect(context, elem);\n\n\t\telemGuid(elem);\n\n\t\tconst keyframes = getKeyframes(context, elem, rect, animationId);\n\n\t\tconst props = {\n\t\t\tnode: elem,\n\t\t\tcontext,\n\t\t\tis3DMatrix: is3DMatrix(animationId),\n\t\t\tease: getEase(animationId),\n\t\t\tkeyframes,\n\t\t\tkeys: Object.keys(keyframes),\n\t\t\tinitialMatrix: getInitialMatrix(elem, is3DMatrix(animationId)),\n\t\t};\n\t\tlist.push(props);\n\n\t\treturn list.concat(getChildren(context, elem, rect, animationId));\n\t}\n\n\t/**\n\t * @param {HTMLElement} ctx\n\t */\n\tconst updateContext = (ctx) => {\n\t\tconst id = elemGuid(ctx);\n\t\tconst context = ctx.tagName === 'HTML' ? window : ctx;\n\t\tif (handlerDictionnary[id]) {\n\t\t\tcontext.removeEventListener('scroll', handlerDictionnary[id]);\n\t\t} else {\n\t\t\thandlerDictionnary[id] = () => { scroll(ctx); };\n\t\t}\n\t\t\n\t\tcontext.addEventListener('scroll', handlerDictionnary[id]);\n\t\thandlerDictionnary[id](ctx);\n\t};\n\n\tthis.updateElements = () => {\n\t\tupdateScreen();\n\t\tcontexts = [];\n\t\tconst nodeList = document.querySelectorAll('[data-animator-id]');\n\t\telements = Array.from(nodeList).reduce(parseElements, []);\n\n\t\tcontexts.forEach(updateContext);\n\t};\n\n\t/**\n\t * @param {array} anims\n\t */\n\tthis.setAnimations = (anims) => {\n\t\tanimations = anims;\n\t\tthis.updateElements();\n\t};\n\n\t/* eslint-disable no-console */\n\tthis.debug = () => {\n\t\tconsole.log('animations', animations);\n\t\tconsole.log('elements', elements);\n\t\tconsole.log('contexts', contexts);\n\t};\n\t/* eslint-enable no-console */\n}\n"],"names":["elemGuid","element","id","getAttribute","Math","random","toString","substring","setAttribute","easeInQuad","t","b","c","d","easeOutQuad","easeInOutQuad","easeInCubic","easeOutCubic","easeInOutCubic","easeInQuart","easeOutQuart","easeInOutQuart","easeInQuint","easeOutQuint","easeInOutQuint","easeInSine","cos","PI","easeOutSine","sin","easeInOutSine","easeInExpo","pow","easeOutExpo","easeInOutExpo","easeInCirc","sqrt","easeOutCirc","easeInOutCirc","easeInElastic","s","p","a","abs","asin","easeOutElastic","easeInOutElastic","easeInBack","undefined","easeOutBack","easeInOutBack","easeInBounce","jQuery","easing","easeOutBounce","easeInOutBounce","translate","x","y","z","scale","w","h","rotate","composeMultiple","matrices","result","a00","a01","a02","a03","a10","a11","a12","a13","a20","a21","a22","a23","a30","a31","a32","a33","b0","b1","b2","b3","inputMatrix","i","length","constrain","num","min","max","n","parseInt","map","in_min","in_max","out_min","out_max","ELEM_BOTTOM","ELEM_TOP","ELEM_CENTER","SCREEN_BOTTOM","SCREEN_TOP","SCREEN_CENTER","instances","updateAll","forEach","instance","updateElements","const","screen","updateScreen","window","innerHeight","valueOrDefault","value","defaultValue","Animator","animations","elements","contexts","handlerDictionnary","loopDictionnary","lastValuesDictionnary","animatorTopDictionnary","getContextScrollTop","context","ctx","tagName","document","scrollingElement","scrollTop","parseVal","prop","elem","matches","match","val","parseFloat","innerWidth","clientHeight","clientWidth","parseRelativeVal","getKeyframes","rect","animationId","props","child","animation","Array","isArray","reduce","anim","values","Object","when","keys","key","from","obj","parts","split","Error","top","height","parseWhen","c2","push","constrainValues","constrained","st","startOffset","endOffset","prc","ease","Ease","startValue","endValue","transformValues","el","propKey","keyframes","propCarry","propVal","offset","transform2d","rotation","scaleX","scaleY","r","transform","getInitialMatrix","is3D","prev","style","getComputedStyle","getPropertyValue","m","replace","trim","matrix2dto3d","getEase","is3DMatrix","force3d","parseElements","list","parentElement","find","getBoundingClientRect","getContext","getRect","node","initialMatrix","concat","children","querySelectorAll","selector","parent","getChildren","this","updateContext","removeEventListener","cancelAnimationFrame","requestAnimationFrame","namespaceURI","indexOf","scaleZ","join","matrix","sign","atan2","tx","ty","JSON","stringify","hasChanged","assign","update","scroll","addEventListener","nodeList","setAnimations","anims","debug","console","log","__animators"],"mappings":"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"}